<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
       .item {
            padding: 15px 0 0 15px;
            float: left;

        }
       .g-container {
           position: relative;
           margin: 0 auto;
       }
        .g-container:after {
            content: "";
            display: block;
            clear: both;
        }
        .pic {
            padding: 10px;
            border: 1px solid #ccc;
            box-shadow: 0 0 5px #ccc;
            border-radius: 12px;
        }
       .pic img{
            width: 230px;
            height: auto;

        }
    </style>
</head>
<body>
    <div class="g-container" id="container">
        <div class="item">
            <div class="pic">
                <img src="images/1.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/2.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/3.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/4.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/5.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/6.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/7.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/8.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/9.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/10.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/11.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/12.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/1.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/2.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/3.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/4.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/5.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/6.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/7.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/8.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/9.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/10.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/11.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/12.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/1.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/2.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/3.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/4.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/5.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/6.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/7.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/8.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/9.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/10.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/11.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/12.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/1.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/2.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/3.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/4.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/5.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/6.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/7.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/8.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/9.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/10.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/11.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/12.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/1.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/2.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/3.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/4.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/5.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/6.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/7.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/8.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/9.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/10.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/11.jpg">
            </div>
        </div>
        <div class="item">
            <div class="pic">
                <img src="images/12.jpg">
            </div>
        </div>


    </div>

</body>
<script>
    // 盒子合理摆放：函数（需要调用两次）
    // 1、页面加载完毕的时候
    // 2、滚动的时候

    // 当文档加载完毕
    window.onload = function() {
        // 调用函数
        fWaterFall();
        window.onscroll = function() {
            if ( fScrollTop() ) {
                console.log(111)
                var container = document.getElementById('container');
                var oItem = document.createElement('div');
                oItem.className = 'item';
                // 创建pic
                var oPic = document.createElement('div');
                oPic.className = 'pic';
                // 创建img
                var oImg = document.createElement('img');
                oImg.src = 'images/1.jpg';
                // 增加操作
                container.appendChild(oItem);
                oItem.appendChild(oPic);
                oPic.appendChild(oImg);
            }
            // 调用函数
            fWaterFall();
        }
    }

    // 判断什么时候什么条件加载图片
    function fScrollTop() {
        console.log(1)
        // 所有item
        var item = document.getElementsByClassName('item');
        // 最后一个item
        console.log(2)
        var lastItem = item[item.length - 1];
        // 获取可视高度
        console.log(3)
        var clientHeight = document.documentElement.clientHeight;
        // 获取滚动距离
        console.log(4)
        var scrollTop = document.documentElement.scrollTop;
        console.log(5)
        if(lastItem.offsetTop > (clientHeight + scrollTop)) {
            console.log(222)
            return true;
        } else {
            console.log(333)
            return false;
        }

    }
    // 盒子合理摆放的函数
    function  fWaterFall() {
        // 获取盒子的宽度
        var container = document.getElementById('container');
        // 可视区域的宽度
        var clientWidth= document.documentElement.clientWidth;
        // 获取到页面所有class为item的元素
        var oItem = document.getElementsByClassName('item');
        // 获取其中一个item的宽度
        var itemWidth = oItem[0].offsetWidth;
        // 一行有多少个
        var num = Math.floor(clientWidth / itemWidth);
        // 设置container的宽度
        container.style.width = num * itemWidth + 'px';


        // 承载盒子高度的数组
        var hrr = [];
        for (var i = 0; i < oItem.length; i++) {
            if (i < num) {
                // 第一排
                hrr.push(oItem[i].offsetHeight);
            } else {
                // ...扩展运算拿出数组中的值
                var minHeight = Math.min(...hrr);
                // 找到对应最小值的下标
                // 查找参数在数组中是否存在,如果存在返回下标,如果不存在返回-1
                // var index = hrr.indexOf(minHeight);
                // 用函数找
                var index = fInArrray(minHeight,hrr)
                // console.log(index);
                // 第一排之后
                oItem[i].style.position = 'absolute';
                // oItem.style.left = 索引 * 一个盒子宽度 + 'px';
                // oItem.style.top = 上面盒子的高度 + 'px';
                oItem[i].style.left = index * itemWidth + 'px';
                oItem[i].style.top = minHeight + 'px';
                // 更新数组最小值
                hrr[index] += oItem[i].offsetHeight;
            }
        }

        // 计算数组最小值
        function fInArrray(min,hrr) {
            for (var i = 0;i<hrr.length;i++){
                if (hrr[i] == min) {
                    return i;
                }
            }
        }
    }
</script>
</html>